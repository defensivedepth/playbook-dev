name: ET INFO Server Responded with Vulnerable OpenSSH Version (CVE-2024-6409)
id: 22054407
description: |
  This alert detects SSH servers responding with OpenSSH versions 8.7 or 8.8 that are vulnerable to CVE-2024-6409.
  The vulnerability may allow security issues in SSH communications. Organizations commonly run OpenSSH servers for
  legitimate remote access purposes, but vulnerable versions should be patched. Investigation should determine if
  the server is authorized, assess its exposure, and verify patching status.
type: detection
detection_id: '2054407'
detection_category: ''
detection_type: nids
contributors:
- SecurityOnionSolutions
created: 2025-10-01
questions:
- question: What SSH server responded with the vulnerable OpenSSH version?
  context: Identifies the specific server that needs patching or further investigation.
  range: +/-5m
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        src_ip: '{destination.ip}'
        dst_port: 22
      condition: selection
    fields:
      - src_ip
      - dst_ip
      - src_port
      - dst_port
      - network.transport
- question: Has this SSH server been accessed from other internal hosts?
  context: Determines the scope of systems that may have connected to the vulnerable server.
  range: -7d
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        dst_ip: '{destination.ip}'
        dst_port: 22
      condition: selection
    fields:
      - src_ip
      - dst_ip
      - src_port
      - connection.state
      - connection.state_description
- question: What is the baseline frequency of SSH connections to this server?
  context: Establishes normal access patterns for this SSH server over the past week.
  range: -7d
  query: |
    aggregation: true
    logsource:
      category: network
      service: connection
    detection:
      selection:
        dst_ip: '{destination.ip}'
        dst_port: 22
      condition: selection
    fields:
      - src_ip
      - dst_ip
- question: What other services are running on this SSH server?
  context: Reveals additional services that may indicate server purpose or other vulnerable services.
  range: -24h
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        src_ip: '{destination.ip}'
      filter:
        src_port: 22
      condition: selection and not filter
    fields:
      - src_ip
      - src_port
      - dst_ip
      - dst_port
      - network.transport
- question: Are there other SSH servers in the environment running vulnerable OpenSSH versions?
  context: Identifies other systems that may require patching based on related alerts.
  range: -24h
  query: |
    aggregation: false
    logsource:
      category: alert
    detection:
      selection:
        rule.uuid: "ET INFO Server Responded with Vulnerable OpenSSH Version (CVE-2024-6409)"
      filter:
        dst_ip: '{destination.ip}'
      condition: selection and not filter
    fields:
      - src_ip
      - dst_ip
      - rule.name
- question: What hosts initiated connections to this SSH server in the past 24 hours?
  context: Maps clients that may be affected if the server is compromised or needs maintenance.
  range: -24h
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        dst_ip: '{destination.ip}'
        dst_port: 22
      condition: selection
    fields:
      - src_ip
      - dst_ip
      - connection.state
      - connection.state_description
- question: Has this server made any outbound connections that could indicate compromise?
  context: Detects unusual outbound activity that could suggest the vulnerable server was exploited.
  range: -24h
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        src_ip: '{destination.ip}'
      private_filter:
        dst_ip|cidr:
          - "10.0.0.0/8"
          - "172.16.0.0/12"
          - "192.168.0.0/16"
      condition: selection and not private_filter
    fields:
      - src_ip
      - dst_ip
      - dst_port
      - connection.state
- question: Were there any failed SSH authentication attempts to this server?
  context: Identifies potential reconnaissance or exploitation attempts against the vulnerable SSH server.
  range: -24h
  query: |
    aggregation: false
    logsource:
      category: alert
    detection:
      selection:
        dst_ip: '{destination.ip}'
        rule.category|contains:
          - "ssh"
          - "brute"
          - "scan"
      condition: selection
    fields:
      - src_ip
      - dst_ip
      - rule.name
      - alert.severity_label
- question: Are there any related security alerts for this SSH server?
  context: Reveals other detections that may indicate active exploitation or reconnaissance activity.
  range: -24h
  query: |
    aggregation: false
    logsource:
      category: alert
    detection:
      selection:
        related_ip: '{destination.ip}'
      filter:
        document_id: '{soc_id}'
      condition: selection and not filter
    fields:
      - src_ip
      - dst_ip
      - rule.name
      - alert.severity_label
      - alert.category
