name: LSASS Dump Keyword In CommandLine
id: 89341138
description: This detection identified command line activity containing keywords associated with LSASS memory dumping, including specific file extensions and tool names commonly used for credential extraction. The detection triggers on various patterns including explicit LSASS dump file names, compressed archives that may contain dumps, and specific dumping tools like nanodump or SQLDmpr. Investigation should focus on determining whether this activity represents legitimate administrative or security testing versus unauthorized credential access attempts.
type: detection
detection_id: ffa6861c-4461-4f59-8a41-578c39f3f23e
detection_category: ""
detection_type: sigma
contributors:
    - SecurityOnionSolutions
created: "2025-09-30T10:23:17-04:00"
questions:
    - question_id: PROC007
      question: Were there any attempts to access LSASS process memory or create memory dumps?
      context: LSASS memory dumps contain Windows authentication credentials and are commonly targeted for credential harvesting.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetImage|endswith: \lsass.exe
                event.outcome: failure
                hostname: '{event_data.host.name}'
        fields:
            - SourceImage
            - TargetImage
            - GrantedAccess
        logsource:
            category: process_access
    - question_id: PROC020
      question: What was the complete command line that contained the LSASS dump keywords including all parameters and file paths?
      context: Full command analysis reveals the specific dumping technique, target file location, and potential evasion methods used.
      query: |
        aggregation: false
        detection:
            condition: selection or parent
            parent:
                ParentProcessGuid: '{event_data.process.entity_id}'
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
        fields:
            - Image
            - CommandLine
        logsource:
            category: process_creation
    - question_id: PROC013
      question: What process executed the command containing LSASS dump keywords and what was its parent process?
      context: Parent-child relationship helps identify if the LSASS dumping command originated from legitimate administrative tools or unauthorized processes.
      range: +/-1h
      query: |
        aggregation: false
        detection:
            condition: selection or parent
            parent:
                ParentProcessGuid: '{event_data.process.entity_id}'
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
        fields:
            - Image
            - ParentImage
            - CommandLine
        logsource:
            category: process_creation
    - question_id: PROC021
      question: Did the process that executed the LSASS dump command spawn any child processes for data handling or cleanup?
      context: Child processes may indicate additional activities like file compression, encryption, or deletion of evidence after credential dumping.
      range: +5m
      query: |
        aggregation: false
        detection:
            condition: selection or parent
            parent:
                ParentProcessGuid: '{event_data.process.entity_id}'
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
        fields:
            - Image
            - CommandLine
        logsource:
            category: process_creation
    - question_id: FILE006
      question: Were any .dmp, .zip, or .rar files created that could contain LSASS memory dumps?
      context: Archive files containing LSASS dumps indicate potential credential theft preparation for exfiltration.
      range: +/-1h
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetFilename|endswith:
                    - .zip
                    - .rar
                    - .7z
                    - .tar
                    - .gz
                hostname: '{event_data.host.name}'
        fields:
            - TargetFilename
            - Image
            - User
            - ProcessGuid
            - file.size
        logsource:
            category: file_event
    - question_id: FILE009
      question: What are the hash values and digital signatures of any dump files or tools involved in the LSASS dumping activity?
      context: File hashing helps identify known credential dumping tools and correlate with threat intelligence indicators.
      range: -10m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetFilename: '{event_data.process.executable}'
                hostname: '{event_data.host.name}'
        fields:
            - TargetFilename
            - Hashes
            - Signed
            - SignatureStatus
            - Subject
        logsource:
            category: file_event
    - question_id: USER001
      question: What user account executed the LSASS dump command and what were their privilege levels?
      context: LSASS dumping typically requires elevated privileges, helping determine if proper administrative access was used.
      range: "0"
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
                hostname: '{event_data.host.name}'
        fields:
            - ProcessGuid
            - ParentProcessGuid
            - Image
            - CommandLine
            - timestamp
        logsource:
            category: process_creation
    - question_id: NET002
      question: What DNS queries occurred around the time of LSASS dumping activity on this host?
      context: DNS activity may reveal communication with command and control infrastructure or download of dumping tools.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                hostname: '{event_data.host.name}'
        fields:
            - dns.query.name
            - dns.resolved_ip
            - process.name
            - timestamp
        logsource:
            category: dns
    - question_id: UNI001
      question: Were there any network connections established before, during, or after the LSASS dump command execution?
      context: Network activity context helps determine if credentials were potentially exfiltrated or if tools were downloaded remotely.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection and filter
            filter:
                hostname: '{event_data.host.name}'
            selection: null
        fields:
            - process.name
            - process.pid
            - process.command_line
            - dst_ip
            - dst_port
        logsource:
            category: network
            product: windows
    - question_id: HIST001
      question: How frequently does this user or host perform LSASS memory dumping activities?
      context: Historical baseline helps distinguish legitimate security testing or debugging from unauthorized credential access attempts.
      range: -90d
      query: |
        aggregation: true
        detection:
            condition: selection
            selection:
                User: '{event_data.user.name}'
                hostname: '{event_data.host.name}'
        fields:
            - Image
            - User
            - CommandLine
        logsource:
            category: process_creation
    - question_id: HUNT004
      question: Have other hosts in the environment executed similar LSASS dumping commands recently?
      context: Network-wide LSASS dumping patterns may indicate coordinated credential harvesting activities or legitimate security assessments.
      range: -24h
      query: |
        aggregation: false
        detection:
            condition: selection and not host_filter
            filter:
                hostname: '{event_data.host.name}'
            host_filter:
                hostname: '{event_data.host.name}'
            selection: null
        fields:
            - Image
            - CommandLine
            - User
            - ParentImage
            - ProcessGuid
        logsource:
            category: process_creation
    - question_id: STAG001
      question: What other executables or tools were present in the same directory as the process that performed LSASS dumping?
      context: Co-located tools may indicate a credential dumping toolkit or legitimate administrative utilities used together.
      range: +/-20m
      query: |
        tool_staging_analysis
