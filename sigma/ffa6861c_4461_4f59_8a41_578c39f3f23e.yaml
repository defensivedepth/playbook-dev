name: LSASS Dump Keyword In CommandLine
id: 24944871
description: A command line was detected containing keywords associated with LSASS memory dumping, including specific file extensions and tool names commonly used for credential extraction. The detection includes various naming patterns used by legitimate tools like ProcDump as well as specialized dumping utilities like nanodump and MirrorDump. This activity requires investigation to determine if it represents authorized administrative activity or unauthorized credential harvesting.
type: detection
detection_id: ffa6861c-4461-4f59-8a41-578c39f3f23e
detection_category: ""
detection_type: sigma
contributors:
    - SecurityOnionSolutions
created: "2025-09-30T12:14:41-04:00"
questions:
    - question_id: PROC007
      question: Were there any attempts to create dump files of the LSASS process or other credential stores?
      context: LSASS dump creation is commonly used for credential extraction and indicates potential security concerns requiring immediate investigation.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetImage|endswith: \lsass.exe
                event.outcome: failure
                hostname: '{event_data.host.name}'
        fields:
            - SourceImage
            - TargetImage
            - GrantedAccess
        logsource:
            category: process_access
    - question_id: PROC020
      question: What was the full command line that contained the lsass dump keywords, including all parameters and file paths?
      context: Complete command line details reveal the specific dumping technique used and the intended output location of LSASS dump files.
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
                hostname: '{event_data.host.name}'
        fields:
            - Image
            - CommandLine
        logsource:
            category: process_creation
    - question_id: PROC013
      question: What is the parent-child process relationship for the process that executed commands containing lsass dump keywords?
      context: Process genealogy helps determine if the LSASS dumping activity originated from legitimate administrative tools or unauthorized processes.
      range: +/-1h
      query: |
        aggregation: false
        detection:
            alert:
                ProcessGuid: '{event_data.process.entity_id}'
                hostname: '{event_data.host.name}'
            children:
                ParentProcessGuid: '{event_data.process.entity_id}'
                hostname: '{event_data.host.name}'
            condition: alert or parent or children
            parent:
                ProcessGuid: '{event_data.process.parent.entity_id}'
                hostname: '{event_data.host.name}'
        fields:
            - Image
            - ParentImage
            - CommandLine
        logsource:
            category: process_creation
    - question_id: PROC021
      question: Did the process containing lsass dump keywords spawn any child processes after execution?
      context: Child processes may reveal additional credential extraction activities, file compression, or data exfiltration attempts following LSASS dumping.
      range: +5m
      query: |
        aggregation: false
        detection:
            alert:
                ProcessGuid: '{event_data.process.entity_id}'
                hostname: '{event_data.host.name}'
            children:
                ParentProcessGuid: '{event_data.process.entity_id}'
                hostname: '{event_data.host.name}'
            condition: alert or children
        fields:
            - Image
            - CommandLine
        logsource:
            category: process_creation
    - question_id: FILE006
      question: Were dump files (.dmp), zip, or rar archives created containing LSASS memory content?
      context: Identifies the creation of files containing LSASS memory dumps which may contain sensitive credential information.
      range: +/-1h
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetFilename|endswith:
                    - .zip
                    - .rar
                    - .7z
                    - .tar
                    - .gz
                hostname: '{event_data.host.name}'
        fields:
            - TargetFilename
            - Image
            - User
            - ProcessGuid
            - file.size
        logsource:
            category: file_event
    - question_id: FILE009
      question: What are the hash values and digital signatures of files created with lsass dump-related names?
      context: Hash verification enables identification of known dumping tools like ProcDump, nanodump, or other credential extraction utilities.
      range: -10m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetFilename: '{event_data.process.executable}'
                hostname: '{event_data.host.name}'
        fields:
            - TargetFilename
            - Hashes
            - Signed
            - SignatureStatus
            - Subject
        logsource:
            category: file_event
    - question_id: USER001
      question: What is the integrity level and logon type of the process that executed lsass dump commands?
      context: LSASS dumping typically requires elevated privileges, so understanding the execution context helps validate legitimate administrative activity.
      range: "0"
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
                hostname: '{event_data.host.name}'
        fields:
            - ProcessGuid
            - ParentProcessGuid
            - Image
            - CommandLine
            - timestamp
        logsource:
            category: process_creation
    - question_id: NET002
      question: What DNS queries were made by this host before and after the lsass dump activity?
      context: DNS patterns may reveal download of dumping tools or connections to infrastructure used for credential extraction operations.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                hostname: '{event_data.host.name}'
        fields:
            - dns.query.name
            - dns.resolved_ip
            - process.name
            - timestamp
        logsource:
            category: dns
    - question_id: UNI001
      question: What network connections were initiated around the time of the lsass dump command execution?
      context: Network activity context helps determine if the LSASS dumping was part of remote administration or potentially unauthorized access.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                hostname: '{event_data.host.name}'
        fields:
            - process.name
            - process.pid
            - process.command_line
            - dst_ip
            - dst_port
        logsource:
            category: network
            product: windows
    - question_id: HIST001
      question: What is the baseline frequency of LSASS dump-related commands for this user and host?
      context: Historical patterns help distinguish routine administrative memory dumps from unusual credential extraction attempts.
      range: -90d
      query: |
        aggregation: true
        detection:
            condition: selection
            selection:
                User: '{event_data.user.name}'
                hostname: '{event_data.host.name}'
        fields:
            - Image
            - User
            - CommandLine
        logsource:
            category: process_creation
    - question_id: HUNT004
      question: What other hosts have executed commands containing lsass and .dmp keywords in the past 24 hours?
      context: Recent network-wide LSASS dumping activity may indicate coordinated credential harvesting or legitimate administrative operations.
      range: -24h
      query: |
        aggregation: false
        detection:
            condition: selection and not host_filter
            host_filter:
                hostname: '{event_data.host.name}'
            selection:
                hostname: '{event_data.host.name}'
        fields:
            - Image
            - CommandLine
            - User
            - ParentImage
            - ProcessGuid
        logsource:
            category: process_creation
    - question_id: STAG001
      question: What other processes executed from the same directory as the lsass dump command?
      context: Co-located tools may indicate a credential extraction toolkit including dump utilities, password crackers, or other post-exploitation tools.
      range: +/-20m
      query: |
        aggregation: true
        detection:
            condition: selection and same_directory
            same_directory:
                CurrentDirectory: '{event_data.process.working_directory}'
            selection:
                hostname: '{event_data.host.name}'
        fields:
            - Image
            - CommandLine
            - User
            - CreationUtcTime
        logsource:
            category: process_creation
    - question_id: REG004
      question: Were registry keys modified to disable Windows Defender, LSASS protection, or memory dump restrictions?
      context: Registry modifications may disable PPL protection for LSASS, Windows Defender scanning, or other security mechanisms that interfere with memory dumping.
      range: +/-1h
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetObject|contains:
                    - Windows Defender
                    - UAC
                    - Audit
                    - Firewall
                    - DisableAntiSpyware
                hostname: '{event_data.host.name}'
        fields:
            - TargetObject
            - Details
            - Image
            - User
            - ProcessGuid
        logsource:
            category: registry_event
