name: LSASS Dump Keyword In CommandLine
id: 47110830
description: This detection identified command line execution containing keywords associated with LSASS memory dumping, including specific dump file names and tool signatures. The activity involves potential access to the Local Security Authority Subsystem Service (LSASS) process memory, which contains cached user credentials and authentication tokens. Investigation should focus on determining whether this represents legitimate administrative memory analysis or unauthorized credential access attempts.
type: detection
detection_id: ffa6861c-4461-4f59-8a41-578c39f3f23e
detection_category: ""
detection_type: sigma
contributors:
    - SecurityOnionSolutions
created: "2025-09-30T11:05:40-04:00"
questions:
    - question_id: PROC007
      question: Were there additional attempts to access LSASS process memory or create memory dumps beyond this detected command?
      context: Multiple LSASS access attempts may indicate systematic credential harvesting operations requiring investigation.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetImage|endswith: \lsass.exe
                event.outcome: failure
                hostname: '{event_data.host.name}'
        fields:
            - SourceImage
            - TargetImage
            - GrantedAccess
        logsource:
            category: process_access
    - question_id: PROC020
      question: What was the complete command line that triggered this LSASS dump detection including all file paths and parameters?
      context: Full command details reveal the specific dumping technique used and target file locations for LSASS memory extraction.
      query: |
        aggregation: false
        detection:
            condition: selection or parent
            parent:
                ParentProcessGuid: '{event_data.process.entity_id}'
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
        fields:
            - Image
            - CommandLine
        logsource:
            category: process_creation
    - question_id: PROC013
      question: What process spawned the command containing LSASS dump keywords and what was its execution chain?
      context: Parent process context helps determine if LSASS dumping originated from legitimate administrative tools or unauthorized execution.
      range: +/-1h
      query: |
        aggregation: false
        detection:
            condition: selection or parent
            parent:
                ParentProcessGuid: '{event_data.process.entity_id}'
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
        fields:
            - Image
            - ParentImage
            - CommandLine
        logsource:
            category: process_creation
    - question_id: PROC021
      question: Did the process executing the LSASS dump command spawn additional processes for credential extraction or data handling?
      context: Child processes may reveal post-dump processing activities such as credential parsing or data staging operations.
      range: +5m
      query: |
        aggregation: false
        detection:
            condition: selection or parent
            parent:
                ParentProcessGuid: '{event_data.process.entity_id}'
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
        fields:
            - Image
            - CommandLine
        logsource:
            category: process_creation
    - question_id: FILE006
      question: Were dump files with names like lsass.dmp, lsass.zip, Andrew.dmp, or other detected variants actually created on disk?
      context: Confirming file creation validates successful LSASS memory extraction and identifies staging locations for investigation.
      range: +/-1h
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetFilename|endswith:
                    - .zip
                    - .rar
                    - .7z
                    - .tar
                    - .gz
                hostname: '{event_data.host.name}'
        fields:
            - TargetFilename
            - Image
            - User
            - ProcessGuid
            - file.size
        logsource:
            category: file_event
    - question_id: FILE009
      question: What are the hash values and digital signatures of any created LSASS dump files or associated executables?
      context: Hash analysis enables correlation with known dumping tools like procdump, nanodump, or custom LSASS extraction utilities.
      range: -10m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetFilename: '{event_data.process.executable}'
                hostname: '{event_data.host.name}'
        fields:
            - TargetFilename
            - Hashes
            - Signed
            - SignatureStatus
            - Subject
        logsource:
            category: file_event
    - question_id: USER001
      question: What user account and privilege level was used to execute the LSASS dump command?
      context: LSASS dumping typically requires elevated privileges, revealing account compromise or legitimate administrative activity context.
      range: "0"
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                ProcessGuid: '{event_data.process.entity_id}'
                hostname: '{event_data.host.name}'
        fields:
            - ProcessGuid
            - ParentProcessGuid
            - Image
            - CommandLine
            - timestamp
        logsource:
            category: process_creation
    - question_id: NET002
      question: What DNS queries were made before or after the LSASS dump command execution?
      context: DNS activity may reveal tool downloads, command and control communications, or data exfiltration staging related to credential access.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                hostname: '{event_data.host.name}'
        fields:
            - dns.query.name
            - dns.resolved_ip
            - process.name
            - timestamp
        logsource:
            category: dns
    - question_id: UNI001
      question: What network connections were established around the time of LSASS dump command execution?
      context: Network activity context helps distinguish between local administrative dumping and potential credential theft with remote exfiltration.
      range: +/-30m
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                hostname: '{event_data.host.name}'
        fields:
            - process.name
            - process.pid
            - process.command_line
            - dst_ip
            - dst_port
        logsource:
            category: network
            product: windows
    - question_id: HIST001
      question: What is the historical frequency of LSASS dump commands or memory access for this user and system?
      context: Baseline analysis helps differentiate routine administrative memory dumps from unusual credential access attempts.
      range: -90d
      query: |
        aggregation: true
        detection:
            condition: selection
            selection:
                User: '{event_data.user.name}'
                hostname: '{event_data.host.name}'
        fields:
            - Image
            - User
            - CommandLine
        logsource:
            category: process_creation
    - question_id: HUNT004
      question: Have other systems executed similar LSASS dump commands with matching keywords in recent timeframes?
      context: Cross-system correlation reveals whether this represents isolated administrative activity or broader credential harvesting operations.
      range: -24h
      query: |
        aggregation: false
        detection:
            condition: selection and not host_filter
            filter:
                hostname: '{event_data.host.name}'
            host_filter:
                hostname: '{event_data.host.name}'
            selection:
                Image: '{event_data.process.executable}'
        fields:
            - Image
            - CommandLine
            - User
            - ParentImage
            - ProcessGuid
        logsource:
            category: process_creation
    - question_id: STAG001
      question: What other executables or scripts were present in the same directory as the process that executed the LSASS dump command?
      context: Co-located files may include additional credential access tools, post-exploitation utilities, or legitimate administrative toolsets.
      range: +/-20m
      query: |
        aggregation: true
        detection:
            condition: selection and same_directory
            same_directory:
                CurrentDirectory: '{event_data.process.working_directory}'
            selection:
                hostname: '{event_data.host.name}'
        fields:
            - Image
            - CommandLine
            - User
            - CreationUtcTime
        logsource:
            category: process_creation
    - question_id: REG004
      question: Were registry modifications made to bypass Windows Defender or disable process protection around LSASS dump execution?
      context: Registry changes may indicate attempts to disable security controls specifically to enable LSASS memory access and dumping.
      range: +/-1h
      query: |
        aggregation: false
        detection:
            condition: selection
            selection:
                TargetObject|contains:
                    - Windows Defender
                    - UAC
                    - Audit
                    - Firewall
                    - DisableAntiSpyware
                hostname: '{event_data.host.name}'
        fields:
            - TargetObject
            - Details
            - Image
            - User
            - ProcessGuid
        logsource:
            category: registry_event
